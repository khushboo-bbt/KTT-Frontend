<div class="multicity-container">
  <!-- Flight Tabs -->
  <div class="d-flex mb-2 flight-tabs align-items-center">
    <ng-container *ngFor="let leg of legs.controls; let i = index">
      <div class="flight-tab" [class.active]="activeFlightIndex === i" (click)="setActiveFlight(i)">
        FLIGHT {{ i + 1 }}
        <span *ngIf="legs.length > 1" class="remove-icon" (click)="removeLeg(i); $event.stopPropagation()">âœ–</span>
      </div>
    </ng-container>
    <div *ngIf="legs.length < 5" class="flight-tab btn add-flight" (click)="addLeg()">
      Add Flight +
    </div>
  </div>

  <!-- Flight Leg Form -->
  <div formArrayName="legs">
    <ng-container *ngFor="let leg of legs.controls; let i = index">
      <div [formGroupName]="i" class="flight-form" *ngIf="activeFlightIndex === i">
        <div class="row mb-3 align-items-center">
          <div class="col-md-5">
            <label for="from">From</label>
            <ng-select
              [items]="listOfAirports"
              bindLabel="displayLabel"
              bindValue="iataCode"
              placeholder="Select Airport"
              [clearable]="false"
              formControlName="origin">
              <ng-template ng-label-tmp let-item="item">
                <span>{{ item.iataCode }} - {{ item.airportCity }}</span>
              </ng-template>
              <ng-template ng-option-tmp let-item="item">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <span>{{ item.airportCity }}</span> (<span>{{ item.iataCode }}</span>)
                    <br />
                    <span style="font-size: 10px; color: gray">{{ item.airportName }}</span>
                  </div>
                </div>
              </ng-template>
            </ng-select>
            <div *ngIf="leg.get('origin')?.invalid && leg.get('origin')?.touched" class="text-danger small">
              Origin is required
            </div>
          </div>
          <div class="col-md-2 text-center">
            <img src="assets/icons/form arrow.svg" alt="arrow" class="arrow-icon mt-4" (click)="onSwap()" />
          </div>
          <div class="col-md-5">
            <label for="to">To</label>
            <ng-select
              [items]="listOfAirports"
              bindLabel="displayLabel"
              bindValue="iataCode"
              placeholder="Select Airport"
              [clearable]="false"
              formControlName="destination">
              <ng-template ng-label-tmp let-item="item">
                <span>{{ item.iataCode }} - {{ item.airportCity }}</span>
              </ng-template>
              <ng-template ng-option-tmp let-item="item">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <span>{{ item.airportCity }}</span> (<span>{{ item.iataCode }}</span>)
                    <br />
                    <span style="font-size: 10px; color: gray">{{ item.airportName }}</span>
                  </div>
                </div>
              </ng-template>
            </ng-select>
            <div *ngIf="leg.get('destination')?.invalid && leg.get('destination')?.touched" class="text-danger small">
              Destination is required
            </div>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-5">
            <label for="departure">Departure</label>
            <input class="form-control" type="date" formControlName="fromDate" [attr.min]="today" />
            <div *ngIf="leg.get('fromDate')?.invalid && leg.get('fromDate')?.touched" class="text-danger small">
              Date is required
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Passenger Controls -->
  <div class="row mb-4">
    <div class="passenger-input col-md-4">
      <label>Adult <span class="age-info">(12+ Yrs)</span></label>
      <ngx-slider formControlName="adults"></ngx-slider>
    </div>
    <div class="passenger-input col-md-4">
      <label>Child <span class="age-info">(2-12 Yrs)</span></label>
      <ngx-slider formControlName="children"></ngx-slider>
    </div>
    <div class="passenger-input col-md-4">
      <label>Infants <span class="age-info">(0-2 Yrs)</span></label>
      <ngx-slider formControlName="infants"></ngx-slider>
    </div>
  </div>

  <!-- Special Fares -->
  <div class="row mb-4">
    <label>Special fares</label>
    <div class="special container d-flex justify-content-between mt-2">
      <span class="btn badge">Armed Forces</span>
      <span class="btn badge">Medical Professionals</span>
      <span class="btn badge">Senior Citizens</span>
      <span class="btn badge">Students</span>
    </div>
  </div>

  <!-- Routes and Class Selection -->
  <div class="row mb-4">
    <div class="col-md-6">
      <label for="routes">Routes</label>
      <select class="form-select" formControlName="routes">
        <option value="Non Stop">Non Stop</option>
        <option value="1 Stop">1 Stop</option>
        <option value="2 Stop">2 Stop</option>
      </select>
    </div>
    <div class="col-md-6">
      <label for="economy">Class</label>
      <select class="form-select" formControlName="class">
        <option value="Economy">Economy</option>
        <option value="Premium Economy">Premium Economy</option>
        <option value="Business">Business</option>
        <option value="First Class">First Class</option>
      </select>
    </div>
  </div>
</div>
